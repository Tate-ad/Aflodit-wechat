阿佛洛狄忒项目说明书
===================

标签： 设计文档 

[TOC]

前言
-------

Aflodit是一个针对用户喜好进行美女图片推荐的微信公众号。主要通过收集用户在浏览图片时的行为数据，归纳用户特征和进行相似性推荐。

目标
-------------

本公众号的第一目标是：有趣。男人都爱看美女，但总有雅俗之分。aflodit希望通过收集用户行为数据，能够实现向用户推荐符合其喜好的图片，并且给出一些有趣的分析报告。

谨慎：
1. 版权问题。
2. 禁止淫秽图片。

系统设计
-------------
采用与程序化广告交易系统类似的架构，组成部分包括：

* 客户端
客户端即一个微信公众号内的网页，当用户浏览美女图片时会发送浏览请求到后台投放引擎。
* 投放引擎
每一次浏览请求都会发送到投放引擎，投放引擎会收集用户信息，并且向所有aflodit节点询问，并且选出最后展示结果，返回给用户展示。
* aflodit节点
aflodit节点的作用就是根据用户信息和数据分析系统的分析结果，给出自己认为最合适的信息返回给引擎，aflodit节点和引擎采用http方式对接。
* 图片爬取系统
图片爬取系统负责从网上爬取图片内容，另外提供一个简单的WEB系统供管理者进行图片审核以及入库等。
* 数据分析系统
投放引擎生成的log将会发送给数据分析系统，分析系统更新分析结果。
* Aflodit Server
Aflodit Server是用来配置Aflodit节点竞争策略的Web 界面。

子系统功能需求
--------------------

#### 客户端
1. 公众号界面

2. 看美女功能
用户点击看美女按钮，跳转到页面。每一页上会展示美女图片以及标签，用户可以评论，选择喜欢，不喜欢。
客户端在展示图片时会开始统计用户数据，并且在下一次浏览请求时发送给投放引擎，收集数据包括：

		（用户ID，图片ID，like，标签，停留时间，是否有放大行为（尺寸比例），评论信息）

#### 投放引擎
投放引擎基本功能是接收用户请求并校验合法性，然后向对接的aflodit节点发送浏览请求，收到结果后根据评分选出优胜并且返回给用户。

#### Aflodit节点
Aflodit节点接收到投放引擎发过来的浏览请求，并且根据数据分析系统得到的分析处理结果，给出匹配的结果返回给引擎。

#### 图片爬取系统
图片爬取系统从网上爬取图片，纳入审核系统。通过审核的图片进入存储区供Aflodit节点使用。

系统要求：

1. 图片存储文件夹地址和mongo连接方式可配置。
1. 爬取到的图片用uuid v4生成唯一id，然后存入图片文件夹，id前两位构成第一级目录名称，完整id作为文件名。
1. 爬取到图片后，向mongo数据库中写入一条记录，包括：
	1. 原始文件名 file_name (string, 原始文件名)
	2. 爬取时间 get_time  (long型标准时间offset in ms）
	3. 文件id file_id  (uuid v4）
	4. 审核状态 status（int，值含义参见附表）
	5. 网页信息 web_info (string, 网页上能爬到的信息)
	6. 用户打标 user_tags (string array, 用户打的标签信息)
	7. 图片文件地址 img_url (url, 图片网络地址)
1. url需要判断重复，如果已经有则不再存储。

#### 数据分析系统
数据分析系统根据投放引擎生成的日志，分析用户行为，生成统计结果。

#### Aflodit Server
Aflodit Server是提供给用户配置竞争策略的web系统，目前已经完成版本1，该系统主要功能包括：

1. 登陆功能，认证通过才可以进入后台页面
2. 审核功能，后台页面会向管理员展示当前爬到的，但是还没有审核的图片，管理员可以将图片分级。

开发计划
-------------

1. 客户端，引擎，图片爬取系统，随机策略的aflodit节点
第一阶段，走通流程，完成图片随机展示功能。

2. 数据分析系统
接触少量初期用户，前端开始抓取用户数据，通过手动方式分析用户数据特征。开发数据分析系统。

3. 推荐策略的aflodit引擎
根据数据分析系统结果，开发采用相似性推荐策略的afloidt节点。

期间根据用户反馈调整功能路线图。

# Aflodit wechat系统设计文档

标签（空格分隔）： wechat aflodit 设计文档 

前言
-------
Aflodit wechat系统是与公众号直接对接的系统。包含的功能有：

1. 接收公众号消息，解析并回复。
2. 客户端浏览页面
3. 管理后台页面
4. 图片展示引擎

由于目前的系统较小，处于成本考虑，将多个功能集成在一个系统里，但是在设计时要考虑将来把系统拆分开的可能性。

API设计
--------

#### 微信对接接口 /wechat

#### 竞价接口 /bid

1. POST /
接收浏览请求

#### 素材结口 /cr

* 图片摘要信息接口 /image
* 用户信息接口 /user
* 图片文件接口 /pic

#### 管理页面接口 /admin

1. GET / 
打开管理页面
2. POST /image/:imageId 
管理员对某一个图片进行审核

#### 客户端页面接口 /
1. GET /
打开浏览页面

业务操作
----------

#### 普通用户
1.普通用户直接进入/。
2.每次用户切换下一张图片时，向bid接口发送请求获得竞价信息，然后通过素材接口展示图片。

#### 管理页面
1.管理员登入/admin，进入管理面板
2.通过点击不同的按钮进入不同的子功能模块

#### 

